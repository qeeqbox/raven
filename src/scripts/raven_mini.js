//  -------------------------------------------------------------
//  author        Giga
//  project       qeeqbox/raven
//  email         gigaqeeq@gmail.com
//  description   raven
//  licensee      AGPL-3.0
//  -------------------------------------------------------------
//  contributors list qeeqbox/raven/graphs/contributors
//  -------------------------------------------------------------
//      "browser": true,
//      "commonjs": true,
//      "jquery": true
//{disable_obfuscation_compression_all}//
//{disable_obfuscation_start}//


class qb_raven_map{constructor(a){this.svg_id=a}init_all(a){this.world_type=a.world_type,this.selected_countries=a.selected_countries,this.remove_countries=a.remove_countries,this.height=a.height,this.width=a.width,this.orginal_background_color=a.backup_background_color,this.orginal_country_color=a.orginal_country_color,this.backup_background_color=a.backup_background_color,this.backup_country_color=a.orginal_country_color,this.clicked_country_color=a.clicked_country_color,this.selected_country_color=a.selected_country_color,this.global_timeout=a.global_timeout,this.global_stats_limit=a.global_stats_limit,this.db_length=a.db_length,this.live_attacks_limit=a.live_attacks_limit,this.location=a.location,this.panels=a.panels,this.disable=a.disable,this.websocket=a.websocket,this.verbose=a.verbose,this.qb_world_countries={},this.qb_world_cities={},this.qb_countries_codes={},this.qb_companies_codes=[],this.qb_ports_codes=[],this.qb_ips_codes=[],this.sensitivity=75,this.markers_queue=[],this.db=[],this.global_lock=!1,this.unknown_flag='<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAWCAYAAABKbiVHAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAEAQAABAEBy2R4jwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAF3SURBVEiJzZaxThtBEIa/XZ+hACQ7BQoSPIHlu9PpJCpQTLpQ0FDmBULDM4BEzVsg0QEvYFGlin0rZMlJZ4GgSRTT3eWyHgpAoqC6Xdn+q9UUnz7NzmhXZVn2F2gw+4wDoFGv1xdbrda/WVkMBoOFsiwLPSuB9xK4Aowxq1rrj0VRjNI0fZy6zHA4XMnz/BA4EJE1ay1BEGCMuSzL8luapg9Tk8nzPAKOgAul1DUwFpGvIrIXBMEHYHtqMpPJ5FZrncZx3H+tdbvds2azOQC2jDHrURTdTUUmSZIRMHpb63Q6/40xf0QEpdRyFa63ber3+7sisqmU+t5ut39WYThvE0CWZR3gHHiw1u4rpaQKx7kzvV4vAq6AR2AnSZL7qiznzmitT4AlrfWnMAx/ObFcZYAW8DsMwx+uIB8ydaDwwHG/plqt9kVEKg2sdxlr7eeX440ry8dqHwMCnLqCfMiMeZZxjrNMHMcbPkTA43PgI3Mlo+bpQ/4E1wl785eim/kAAAAASUVORK5CYII="/>'}async init_world(){this.spinner_on_off(!0,"[!] Initializing.."),await this.load_scripts(),$.fn.is_partially_visible=function(){try{return $(this).offset().top+$(this).outerHeight()<=$(window).scrollTop()+$(window).height()}catch(a){return!1}},this.spinner_on_off(!0,"[!] Init interface"),this.setup_task_bar(),this.setup_raven_multi_output_panel(),this.setup_raven_single_output_panel(),this.setup_raven_insert_panel(),this.setup_raven_tooltip_panel(),this.setup_raven_random_panel(),this.startup_windwos(),this.verbose&&console.log("Init qb_worldmap"),this.projection=d3.geoEquirectangular().scale(this.width/2/Math.PI).translate([this.width/2,this.height/2]).rotate([0]),this.org_scale=this.projection.scale(),this.path=d3.geoPath(this.projection).pointRadius(1.5),this.svg=d3.select(this.svg_id).append("svg").attr("height",this.height).attr("width",this.width),this.svg.call(d3.drag().on("drag",()=>{let a=this.projection.rotate(),b=this.sensitivity/this.projection.scale();this.projection.rotate([a[0]+d3.event.dx*b]),this.svg.selectAll("path").attr("d",this.path),this.svg.selectAll(".raven-worldmap-route").attr("d",this.curved_marker)})).call(d3.zoom().scaleExtent([1,5]).on("zoom",()=>{this.projection.scale(this.org_scale*d3.event.transform.k),this.svg.selectAll("path").attr("d",this.path),this.svg.selectAll(".raven-worldmap-route").attr("d",this.curved_marker)})),this.custom_curve=function(b){let a=d3.curveLinear(b);return a._context=b,a.point=function(a,b){switch(a=+a,b=+b,this._point){case 0:this._point=1,this._line?this._context.lineTo(a,b):this._context.moveTo(a,b),this.x0=a,this.y0=b;break;case 1:this._point=2;default:80>Math.sqrt(Math.pow(a-this.x0,2)+Math.pow(b-this.y0,2))?this._context.quadraticCurveTo(.5*a+.5*this.x0,.5*b+.5*this.y0,a,b):this._context.quadraticCurveTo(.5*a+.5*this.x0,.5*b+.5*this.y0-100,a,b),this.x0=a,this.y0=b}},a},this.curved_marker=d3.line().curve(this.custom_curve).x(a=>this.projection([a[0],a[1]])[0]).y(a=>this.projection([a[0],a[1]])[1]),this.q_tween_start=function(){return b=>{let a=this.getTotalLength();d3.select(this).attr("stroke-dasharray",a),d3.select(this).attr("stroke-dashoffset",d3.interpolateNumber(a,0)(b))}},this.q_tween_end=function(){return b=>{let a=this.getTotalLength();d3.select(this).attr("stroke-dasharray",a),d3.select(this).attr("stroke-dashoffset","-"+d3.interpolateNumber(0,a)(b))}},this.delay=a=>new Promise(b=>setTimeout(b,a)),this.current_time=()=>new Date().toJSON().replace("T"," "),this.get_nested_value=(a,...b)=>{try{return b.reduce((a,b)=>a&&a[b],a)}catch(c){return}},this.group_by_key=(a,b)=>a.reduce(function(a,c){return a[c[b]]=a[c[b]]||0,a[c[b]]+=1,a},{}),d3.select(window).on("resize",a=>this.size_changed(a)),await this.fetch_data(),this.spinner_on_off(!1)}async fetch_data(){this.verbose&&console.log("Fetch countries and cities"),await Promise.all([this.qb_world_countries=topojson.feature(qb_world_countries,qb_world_countries.objects.countries).features.filter(a=>!this.remove_countries.includes(a.properties.cc)),this.qb_world_cities=qb_world_cities,this.qb_private_ips_codes=qb_private_ips_codes,this.qb_countries_codes=qb_countries_codes,this.qb_companies_codes=qb_companies_codes,this.qb_ports_codes=qb_ports_codes,this.qb_ips_codes=qb_ips_codes]).then(()=>{this.qb_countries_codes&&this.qb_world_countries?this.draw():this.verbose&&console.log("qb_world_countries and qb_countries_codes modules are needed")}).catch(a=>this.verbose&&console.log(a))}async load_scripts(){var b=[],c=["qb_world_countries","qb_companies_codes","qb_countries_codes","qb_ips_codes","qb_world_cities","qb_ports_codes"].filter(a=>!this.disable.includes(a));new Promise(()=>{c.forEach(a=>{void 0!==window[a]||b.includes(a)||(this.spinner_on_off(!0,"[!] Loading: "+a),$.holdReady(!0),$.getScript(this.location+"/"+a+".js",function(){$.holdReady(!1),b.push(a)}))})}).catch(a=>this.verbose&&console.log(a));let a=()=>new Promise((a,d)=>{setTimeout(()=>{var e=[];if(b.sort().toString()==c.sort().toString()){if(c.forEach(a=>{this.spinner_on_off(!0,"[!] Loaded: "+a),e.push(a)}),e.sort().toString()==c.sort().toString())return this.disable.includes("qb_companies_codes")&&(window.qb_companies_codes=[]),this.disable.includes("qb_ips_codes")&&(window.qb_private_ips_codes=[],window.qb_ips_codes=[]),this.disable.includes("qb_ports_codes")&&(window.qb_ports_codes=[]),this.disable.includes("qb_world_cities")&&(window.qb_world_cities={}),a()}else d()},100)}).catch(()=>a());return await a(),1}draw(){this.svg.append("path").datum({type:"Sphere"}).attr("class","raven-worldmap-water").attr("d",this.path),this.svg.selectAll(".raven-worldmap-country").data(this.qb_world_countries).enter().insert("path").attr("class","raven-worldmap-country").attr("d",this.path).attr("id",function(a){return"raven-worldmap-country-"+a.properties.cc}).on("click",a=>{this.disable.includes("move_to_country")||this.move_to_country("cc",a.properties.cc,this.global_timeout,this.global_stats_limit)})}size_changed(){try{let a=document.getElementById(this.svg_id.substring(1)).clientWidth;this.svg.attr("width",a),this.projection.translate([a/2,this.height/2]),this.svg.selectAll(".raven-worldmap-country").attr("d",this.path),this.svg.selectAll(".raven-worldmap-city").attr("d",this.path),this.svg.selectAll(".raven-worldmap-route").attr("d",this.curved_marker)}catch(b){this.verbose&&console.log(b)}}move_to_country(e,f,j,k){let a,c={},d=[];try{if("cc"===e&&(this.verbose&&console.log("move to {country}".replace("{country}",f)),null!==this.qb_world_countries&&(a=this.qb_world_countries.find(a=>a.properties.cc===f))&&a.properties.cc in this.qb_countries_codes&&(c=JSON.parse(JSON.stringify(this.qb_countries_codes[a.properties.cc])))),"detect"===e){this.verbose&&console.log("move to {country}".replace("{country}",f));let b=f.split(":"),g=this.filter_by_ip(this.qb_private_ips_codes,b[0]);if(g&&"object"==typeof g){if(2===b.length){b[1]=parseInt(b[1]);let h=JSON.parse(JSON.stringify(this.qb_ports_codes.find(a=>a.p===b[1])));h&&"object"==typeof h&&(c.p=h)}return c.i=g.i,[null,c]}if(a=this.filter_by_ip(this.qb_ips_codes,b[0]),d=this.filter_by_ip_with_info(this.qb_companies_codes,b[0]),a&&"object"==typeof a&&(a=this.qb_world_countries.find(b=>b.properties.cc===a.cc))&&(a.properties.cc in this.qb_countries_codes&&(c=JSON.parse(JSON.stringify(this.qb_countries_codes[a.properties.cc]))),d&&"object"==typeof d&&(c.co=d.info),2===b.length)){b[1]=parseInt(b[1]);let i=this.qb_ports_codes.find(a=>a.p===b[1]);i&&"object"==typeof i&&(c.p=i)}}if(void 0!==a&&"type"in a)return"detect_222"!==e&&(this.get_db_stats(a.properties.cc,k),$("#raven-tooltip-panel").dialog("open")),d3.transition().delay(180).duration(1e3).tween("rotate",()=>{let b=d3.geoCentroid(a),c=d3.interpolate(this.projection.rotate(),[-b[0],-b[1]]);return a=>{this.projection.rotate(c(a)),this.svg.selectAll(".raven-worldmap-country").attr("d",this.path),this.svg.selectAll(".raven-worldmap-city").attr("d",this.path),this.svg.selectAll(".raven-worldmap-route").attr("d",this.curved_marker)}}).transition(),d3.select("#raven-worldmap-country-"+a.properties.cc).transition().duration(j).style("fill",this.clicked_country_color).transition().duration(j).style("fill",this.orginal_country_color),[a,c]}catch(l){this.verbose&&console.log(l)}return[null,null]}add_marker_by_gussing(d,p={},o=5e3,i=[]){let j=this.current_time(),e=JSON.parse(JSON.stringify(p)),h=[],g=null,c={from:d.from,to:d.to,active:!1,from_method:"",to_method:"",from_result:!1,to_result:!1,time:j},b={from:null,to:null};try{for(let a of["from","to"])if("string"==typeof d[a]||object.from instanceof String){if(!d[a].match(/\d/)&&Object.keys(this.qb_countries_codes).length>0&&Object.keys(this.qb_world_countries).length>0)-1==d[a].indexOf(",")?d[a]in this.qb_countries_codes&&(b[a]=this.qb_countries_codes[d[a]],c[a]=b[a],b[a]=this.qb_world_countries.find(c=>c.properties.cc===b[a].cc),b[a]=d3.geoCentroid(b[a]),b[a]={type:"Feature",geometry:{type:"Point",coordinates:[b[a][0],b[a][1]]}}):Object.keys(this.qb_world_cities).length>0&&d[a]in this.qb_world_cities?(b[a]=this.qb_world_cities[d[a]],"object"==typeof b[a]&&null!==b[a]&&(b[a].properties.cc in this.qb_countries_codes&&(delete c[a],c[a]=JSON.parse(JSON.stringify(this.qb_countries_codes[b[a].properties.cc]))),c[a].c=b[a].properties.n)):(b[a]=d[a].split(","),2===b[a].length&&b[a][1]in this.qb_countries_codes&&(b[a]=this.qb_countries_codes[b[a][1]],c[a]=b[a],b[a]=this.qb_world_countries.find(c=>c.properties.cc===b[a].cc),b[a]=d3.geoCentroid(b[a]),b[a]={type:"Feature",geometry:{type:"Point",coordinates:[b[a][0],b[a][1]]}})),c[a+"_method"]="name";else if(d[a].match(/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/)&&this.qb_private_ips_codes.length>0&&this.qb_ips_codes.length>0&&this.qb_companies_codes.length>0&&Object.keys(this.qb_countries_codes).length>0&&this.qb_ports_codes.length>0&&Object.keys(this.qb_world_countries).length>0){let f=d[a].split(":");b[a]=this.filter_by_ip(this.qb_ips_codes,f[0]),h=this.filter_by_ip_with_info(this.qb_companies_codes,f[0]);let k=this.filter_by_ip(this.qb_private_ips_codes,f[0]);if(k&&"object"==typeof k){if(c[a]={ip:d.from},2===f.length){f[1]=parseInt(f[1]);let l=JSON.parse(JSON.stringify(this.qb_ports_codes.find(a=>a.p===f[1])));l&&"object"==typeof l&&(c[a].p=l)}c[a].i=k.i}else if("object"==typeof b[a]&&b[a]&&b[a].cc in this.qb_countries_codes){if(delete c[a],c[a]=JSON.parse(JSON.stringify(this.qb_countries_codes[b[a].cc])),h&&"object"==typeof h&&(c[a].co=h.info),2===f.length){f[1]=parseInt(f[1]);let m=this.qb_ports_codes.find(a=>a.p===f[1]);m&&"object"==typeof m&&(c[a].p=m)}c[a].ip=d[a],b[a]=this.qb_world_countries.find(c=>c.properties.cc===b[a].cc),b[a]=d3.geoCentroid(b[a]),b[a]={type:"Feature",geometry:{type:"Point",coordinates:[b[a][0],b[a][1]]}}}c[a+"_method"]="ip"}else if(d[a].match(/([0-9.-]+).+?([0-9.-]+)/)&&Object.keys(this.qb_countries_codes).length>0){if(d[a]=d[a].split(","),i.includes("country-by-coordinate")){let n=this.get_country_by_coordinate(d[a][0],d[a][1]);void 0!==n&&n in this.qb_countries_codes&&(delete c[a],c[a]=JSON.parse(JSON.stringify(this.qb_countries_codes[n])))}b[a]={type:"Feature",geometry:{type:"Point",coordinates:[d[a][1],d[a][0]]}},"string"==typeof c[a]&&(c[a]={coordinates:[d[a][1],d[a][0]]}),c[a+"_method"]="coordinates"}}i.includes("line")?(this.get_nested_value(b,"from","geometry","coordinates")&&(b.from.geometry.coordinates.includes(NaN)||(c.from_result=!0)),this.get_nested_value(b,"to","geometry","coordinates")&&(b.to.geometry.coordinates.includes(NaN)||(c.to_result=!0)),c.from_result&&c.to_result?(g=j+"-line-"+c.method+JSON.stringify([b.from.geometry,b.to.geometry]),this.markers_queue.includes(g)||(null===e.line.from&&(e.line.from=this.random_bg_color()),null===e.line.to&&(e.line.to=this.random_bg_color()),this.draw_line_mark(b.from,b.to,e.line.from,e.line.to,o,g),c.active=!0)):"object"==typeof c.from&&"object"==typeof c.to&&(c.active=!0,c.from_result=!0,c.to_result=!0)):i.includes("point")&&(this.get_nested_value(b,"from","geometry","coordinates")&&(b.from.geometry.coordinates.includes(NaN)||(c.from_result=!0)),c.from_result?(g=j+"-point-"+c.method+JSON.stringify([b.from.geometry]),this.markers_queue.includes(g)||(null===e.line.from&&(e.line.from=this.random_bg_color()),this.draw_point_mark(b.from,e.line.from,o,g),c.active=!0)):"object"==typeof c.from&&(c.active=!0,c.from_result=!0))}catch(q){this.verbose&&console.log(q)}return c.from_result||(c.from=d.from),c.to_result||(c.to=d.to),c}mark_a_country(a,c,b,d){this.verbose&&console.log("Go to country {country_code_3}".replace("{country_code_3}",a)),this.svg.select("#raven-worldmap-country-"+a).transition().duration(b).style("fill",c).transition().on("end",()=>{let a=this.markers_queue.indexOf(d);a> -1&&(this.markers_queue.splice(a,1),this.verbose&&console.log(d+" was removed from markers_queue"))}).duration(b).style("fill",this.orginal_country_color)}draw_point_mark(a,c,b,d){try{"geometry"in a&&!document.hidden&&(this.markers_queue.push(d),this.svg.append("path").attr("class","raven-worldmap-point").datum([a.geometry.coordinates]).attr("d",this.curved_marker).attr("stroke",c).transition().duration(b).attr("opacity",1).transition().on("end",()=>{let a=this.markers_queue.indexOf(d);a> -1&&(this.markers_queue.splice(a,1),this.verbose&&console.log(d+" was removed from markers_queue"))}).duration(b).attr("opacity",0).remove())}catch(e){this.verbose&&console.log(e)}}draw_line_mark(a,b,d,e,c,f){try{"geometry"in a&&"geometry"in b&&!document.hidden&&(this.markers_queue.push(f),this.svg.append("path").attr("class","raven-worldmap-route").datum([a.geometry.coordinates,b.geometry.coordinates]).attr("d",this.curved_marker).attr("stroke",d).attr("stroke-dasharray",function(){return this.getTotalLength()}).transition().duration(c).tween("qtween",this.q_tween_start).transition().on("end",()=>{let a=this.markers_queue.indexOf(f);a> -1&&(this.verbose&&this.markers_queue.splice(a,1),this.verbose&&console.log(f+" was removed from markers_queue"))}).attr("stroke",e).duration(c).tween("qtween",this.q_tween_end).remove())}catch(g){this.verbose&&console.log(g)}}filter_by_ip(b=[],a=""){try{if(/^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/.test(a)){let d=((256*+a.split(".")[0]+ +a.split(".")[1])*256+ +a.split(".")[2])*256+ +a.split(".")[3];return b.find(a=>a.from<=d&&a.to>=d)}}catch(c){this.verbose&&console.log(c)}}filter_by_ip_with_info(b=[],a=""){try{if(/^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/.test(a)){let e=((256*+a.split(".")[0]+ +a.split(".")[1])*256+ +a.split(".")[2])*256+ +a.split(".")[3],c=b.find(b=>{let a=b.data.find(a=>e>=a.from&&e<=a.to);return!!a&&"object"==typeof a});return c}}catch(d){this.verbose&&console.log(d)}}filter_by_key_value(a=[],d={}){try{let b=a.filter(a=>Object.keys(d).every(b=>d[b].toLowerCase()===a[b].toLowerCase()));return b[0]}catch(c){this.verbose&&console.log(c)}return null}get_country_by_coordinate(a,b){var c=void 0,a=parseFloat(a),b=parseFloat(b);return this.qb_world_countries.some(function(d){if("MultiPolygon"==d.geometry.type)return d.geometry.coordinates.some(function(e){return e.some(function(e){let g=!1;for(let f=0,h=e.length-1;f<e.length;h=f++)e[f][1]>a!=e[h][1]>a&&b<(e[h][0]-e[f][0])*(a-e[f][1])/(e[h][1]-e[f][1])+e[f][0]&&(g=!g);return g&&(c=d.properties.cc),g})})}),c}random_bg_color(){let a=[0,Math.floor(256*Math.random()),255];for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1));[a[b],a[c]]=[a[c],a[b]]}return"#"+a.map(a=>a.toString(16).padStart(2,"0")).join("")}spinner_on_off(b,a=""){try{b?(""!==a?(document.getElementById("raven-waiting-msg").innerHTML=a,document.getElementById("raven-waiting-msg").style.display="block"):document.getElementById("raven-waiting-msg").style.display="none",document.getElementById("raven-waiting").style.display="block",document.getElementById("raven-waiting-msg").style.display="block",document.getElementById("raven-waiting-box").style.display="block"):(document.getElementById("raven-waiting-box").style.display="none",document.getElementById("raven-waiting").style.display="none",document.getElementById("raven-waiting-msg").style.display="")}catch(c){this.verbose&&console.log(c)}}setup_raven_multi_output_panel(){if(this.panels.includes("multi-output")){$("#raven-multi-output-panel").dialog({width:500,maxWidth:500,autoOpen:!1,position:{my:"left bottom",at:"left+40 bottom-40",of:window},closeText:"",autoResize:!0,modal:!1,resizable:!1,minHeight:"auto",dialogClass:"raven-multi-output-panel",close:()=>{this.disable_enable_item_taskbar(!0,"multi-output")}});let a=new ResizeObserver(()=>{!0!==$("#raven-multi-output-panel").dialog("isOpen")||$("#raven-multi-output-panel").is_partially_visible()||$("#raven-multi-output-panel").dialog("option","position",{my:"left bottom",at:"left+40 bottom-40",of:window,using:function(a,b){$(this).animate({top:a.top},200)}})});a.observe($("#raven-multi-output-panel")[0])}else $("#raven-multi-output-panel").hide(),this.disable_enable_item_taskbar(!1,"multi-output")}setup_raven_single_output_panel(){this.panels.includes("single-output")?$("#raven-single-output-panel").css({display:"flex"}):$("#raven-single-output-panel").hide()}setup_raven_insert_panel(){if(this.panels.includes("insert")){$("#raven-insert-panel").dialog({width:500,maxWidth:500,autoOpen:!1,position:{my:"left bottom",at:"left+40 bottom-40",of:window},closeText:"",autoResize:!0,modal:!1,resizable:!1,minHeight:"auto",dialogClass:"raven-insert-panel",close:()=>{this.disable_enable_item_taskbar(!0,"insert")}}),$("#raven-insert-result").hide(),$("body").on("click","#raven-insert-button",()=>{this.raven_insert_button($("#raven-insert-text").val())}),$("body").on("keypress","#raven-insert-text",a=>{if(13==a.which)return this.raven_insert_button($("#raven-insert-text").val()),!1});let a=new ResizeObserver(()=>{!0!==$("#raven-insert-panel").dialog("isOpen")||$("#raven-insert-panel").is_partially_visible()||$("#raven-insert-panel").dialog("option","position",{my:"left bottom",at:"left+40 bottom-40",of:window,using:function(a,b){$(this).animate({top:a.top},500)}})});a.observe($("#raven-insert-panel")[0])}else $("#raven-insert-panel").hide(),this.disable_enable_item_taskbar(!1,"insert")}setup_raven_tooltip_panel(){this.panels.includes("tooltip")?$("#raven-tooltip-panel").dialog({width:500,maxWidth:500,autoOpen:!1,position:{my:"center",at:"center",of:window},closeText:"",autoResize:!0,modal:!1,resizable:!1,minHeight:"auto",dialogClass:"raven-tooltip-panel"}):($("#raven-tooltip-panel").hide(),this.disable_enable_item_taskbar(!1,"tooltip"))}setup_raven_random_panel(){this.panels.includes("random")?($("#raven-random-panel").dialog({width:500,maxWidth:500,autoOpen:!1,position:{my:"left bottom",at:"left+40 bottom-40",of:window},closeText:"",autoResize:!0,modal:!1,resizable:!1,minHeight:"auto",dialogClass:"raven-random-panel",close:()=>{this.disable_enable_item_taskbar(!0,"random")}}),$("body").on("click",'.raven-random-panel input[type="button"]:not(#raven-random-generate-button)',a=>{$(a.currentTarget).toggleClass("raven-random-button-active")}),$("body").on("click",".raven-random-panel #raven-random-generate-button",()=>{let a=[];$(".raven-random-button-active").each(function(){a.push($(this).val())}),a.length>0&&""!==$("#raven-random-text").val()&&""!==$("#raven-random-timeout").val()&&""!==$("#raven-random-delay").val()&&this.random_data(parseInt($("#raven-random-text").val()),parseInt($("#raven-random-timeout").val()),parseInt($("#raven-random-delay").val()),a)})):($("#raven-random-panel").hide(),this.disable_enable_item_taskbar(!1,"random"))}setup_task_bar(){this.panels.includes("taskbar")&&($("#taskbar-panel").dialog({position:{at:"right top",my:"right-40 top+40",of:window},closeText:"",width:"auto",autoResize:!0,modal:!1,resizable:!1,minHeight:"auto",dialogClass:"taskbar-panel"}),$("body").on("click",".taskbar-panel-body #multi-output",()=>{$("#raven-multi-output-panel").dialog("open"),this.disable_enable_item_taskbar(!1,"multi-output")}),$("body").on("click",".taskbar-panel-body #insert",()=>{$("#raven-insert-panel").dialog("open"),this.disable_enable_item_taskbar(!1,"insert")}),$("body").on("click",".taskbar-panel-body #random",()=>{$("#raven-random-panel").dialog("open"),this.disable_enable_item_taskbar(!1,"random"),$("#raven-random-text").val("25"),$("#raven-random-timeout").val("1000"),$("#raven-random-delay").val("500")}),$("body").on("click",".taskbar-panel-body #reset",async()=>{this.spinner_on_off(!0,"Resetting interface"),this.global_lock=!0,this.db=[],await this.delay(2e3),this.reset_everything(),this.global_lock=!1,this.spinner_on_off(!1)}),$("#global-country-color").on("input",()=>{let a=$("#global-country-color").val();this.orginal_country_color=a,$("path[id^='raven-worldmap-country']").each(function(){$(this).css({fill:a,stroke:"#313131"})})}),$("#global-background-color").on("input",()=>{let a=$("#global-background-color").val();$("body").css({"background-color":a}),$(".raven-worldmap-water").css({fill:a,stroke:a})}),$("#sun-style").on("click",()=>{this.change_color("#AE9C86","#C4E4ED")}),$("#moon-style").on("click",()=>{this.change_color("#666666","#252525")}),$("#half-moon-style").on("click",()=>{this.change_color("#494949","#252525")}),$("#global-background-color").val(this.orginal_background_color),$("#global-country-color").val(this.orginal_country_color),this.disable_enable_item_taskbar(!0,"random"),this.disable_enable_item_taskbar(!0,"multi-output"),this.disable_enable_item_taskbar(!0,"insert"),this.panels.includes("logo")||($("#qeeqbox-logo").remove(),$("#qeeqbox-logo-separator").remove()))}change_color(b,a){this.orginal_country_color=b,$("path[id^='raven-worldmap-country']").each(function(){$(this).css({fill:b,stroke:"#313131"})}),this.orginal_background_color=a,$("body").css({"background-color":a}),$(".raven-worldmap-water").css({fill:a,stroke:a}),$("#global-background-color").val(this.orginal_background_color),$("#global-country-color").val(this.orginal_country_color)}startup_windwos(){}reset_everything(){this.panels.includes("insert")&&$("#raven-insert-panel").dialog("close"),this.panels.includes("insert")&&$("#raven-insert-text").val(""),this.panels.includes("insert")&&$("#raven-insert-result").hide(),this.panels.includes("multi-output")&&$("#raven-multi-output-panel-body-table").html(""),this.panels.includes("multi-output")&&$("#raven-multi-output-panel").dialog("close"),this.panels.includes("single-output")&&$("#raven-single-output-panel-body").html(""),this.panels.includes("random")&&$("#raven-random-panel").dialog("close"),$("#global-background-color").val(this.backup_background_color),$("#global-country-color").val(this.backup_country_color);let b=$("#global-country-color").val();this.orginal_country_color=b,$("path[id^='raven-worldmap-country']").each(function(){$(this).css({fill:b,stroke:"#313131"})});let a=$("#global-background-color").val();this.orginal_background_color=a,$("body").css({"background-color":a}),$(".raven-worldmap-water").css({fill:a,stroke:a})}disable_enable_item_taskbar(b,a){try{if(this.panels.includes("taskbar")){if(b)switch(a){case"single-output":$(".taskbar-panel-body").prepend('<div id="single-output" ><i class="fa fa-single-table" aria-hidden="true"></i></div>');break;case"multi-output":$(".taskbar-panel-body").prepend('<div id="multi-output" ><i class="fa fa-table" aria-hidden="true"></i></div>');break;case"insert":$(".taskbar-panel-body").prepend('<div id="insert" ><i class="fa fa-pencil-square-o" aria-hidden="true"></i></div>');break;case"random":$(".taskbar-panel-body").prepend('<div id="random" ><i class="fa fa-random" aria-hidden="true"></i></div>');break;case"setting":$(".taskbar-panel-body").append('<div id="setting" ><i class="fa fa-cog" aria-hidden="true"></i></div>')}else $(".taskbar-panel-body #"+a).remove();window.addEventListener("resize",()=>{$("#taskbar-panel").dialog("option","position",{at:"right top",my:"right-40 top+40",of:window})}),$("#taskbar-panel").dialog("option","position",{at:"right top",my:"right-40 top+40",of:window})}}catch(c){this.verbose&&console.log(c)}}raven_insert_button(c){let a=this.move_to_country("detect",c,2e3),b="";a[1]&&"{}"!==JSON.stringify(a[1])?("f"in a[1]&&""!==a[1].f&&(b+='<img src="data:image/png;base64,'+a[1].f+'"/>'),"n"in a[1]&&""!==a[1].n&&(b+="Country: "+a[1].n+"<br>"),"co"in a[1]&&""!==a[1].co&&(b+="Whois: "+a[1].co+"<br>"),"i"in a[1]&&""!==a[1].i&&(b+="Private IP: "+a[1].i+"<br>"),"p"in a[1]&&(b+="Port info: "+a[1].p.n+" "+a[1].p.p+"/"+a[1].p.t),$("#raven-insert-result").html(b),$("#raven-insert-result").show()):($("#raven-insert-result").html("Unknown, please insert valid input"),$("#raven-insert-result").hide())}add_to_db(a){this.db.length>this.db_length&&this.db.shift(),this.db.push(a)}add_to_data_to_table(f,g,h,c=[],j=null){let d=!1,a={};try{if(a=this.add_marker_by_gussing(f,g,h,c),"active"in a){if(a.from_result||a.to_result){let e="\u2B95",b={from:{flag:"?",info:[]},to:{flag:"?",info:[]}};c.includes("multi-output")&&$("#raven-multi-output-panel-body-table").children().length>this.live_attacks_limit&&$("#raven-multi-output-panel-body-table .country-row:first").remove(),["from","to"].forEach(c=>{let d=!0;if("object"==typeof a[c]&&null!==a[c]){if("f"in a[c]&&""!==a[c].f&&(b[c].flag=a[c].f),j&&j[c])for(let[e,f]of(d=!1,Object.entries(j[c])))b[c].info.push(e+": "+f);d&&("ip"in a[c]&&""!==a[c].ip&&b[c].info.push("IP: "+a[c].ip),"i"in a[c]&&""!==a[c].i&&b[c].info.push("Private IP: "+a[c].i),"p"in a[c]&&b[c].info.push("Port info: "+a[c].p.n+" "+a[c].p.p+"/"+a[c].p.t),"co"in a[c]&&""!==a[c].co&&b[c].info.push("Whois: "+a[c].co),"c"in a[c]&&""!==a[c].c&&b[c].info.push("City: "+a[c].c),"n"in a[c]&&""!==a[c].n&&b[c].info.push("Country: "+a[c].n),"coordinates"in a[c]&&2==a[c].coordinates.length&&(b[c].info.push("Latitude: "+a[c].coordinates[0]),b[c].info.push("Longitude: "+a[c].coordinates[1])))}else b[c].info.push("Unknown: "+a[c])}),a.from_result&&a.to_result?(c.includes("multi-output")&&$("#raven-multi-output-panel-body-table").append('<div class="country-row"><div class="time">'+a.time+'</div><div class="country-flag">'+b.from.flag+'</div><div class="country-info">'+b.from.info.join("<br>")+'</div><div class="action">'+e+'</div><div class="country-flag">'+b.to.flag+'</div><div class="country-info">'+b.to.info.join("<br>")+"</div></div>"),c.includes("single-output")&&$("#raven-single-output-panel-body").html('<div class="country-row"><div class="time">'+a.time+'</div><div class="country-flag">'+b.from.flag+'</div><div class="country-info-full-width">'+b.from.info.join("<br>")+'</div><div class="action">'+e+'</div><div class="country-flag">'+b.to.flag+'</div><div class="country-info-full-width">'+b.to.info.join("<br>")+"</div></div>")):a.from_result&&!a.to_result&&(c.includes("multi-output")&&$("#raven-multi-output-panel-body-table").append('<div class="country-row"><div class="time">'+a.time+'</div><div class="country-flag">'+b.from.flag+'</div><div class="country-info">'+b.from.info.join("<br>")+"</div></div>"),c.includes("single-output")&&$("#raven-single-output-panel-body").html('<div class="country-row"><div class="time">'+a.time+'</div><div class="country-flag">'+b.from.flag+'</div><div class="country-info-full-width">'+b.from.info.join("<br>")+"</div></div>")),"object"==typeof a.from&&null!==a.from&&"object"==typeof a.to&&null!==a.to&&"n"in a.from&&"n"in a.to&&""!==a.from.n&&""!==a.to.n&&(d=!0)}else this.verbose&&console.log("Something wrong..",a)}}catch(i){this.verbose&&console.log(i)}return d}fetch_data_from_server(){var a=!1,b=()=>{var b=new WebSocket(this.websocket.server);return new Promise((c,d)=>{b.onopen=()=>{c(a=!0)},b.onmessage=a=>{try{let b=JSON.parse(a.data);b.forEach(a=>{"table"==a.function?this.add_to_data_to_table(a.object,a.color,a.timeout,a.options,a.custom):"marker"==a.function&&this.add_marker_by_gussing(a.object,a.color,a.timeout,a.options)})}catch(c){this.verbose&&console.log(c)}},b.onerror=b=>{a=!1,d(b)},b.onclose=b=>{a=!1,d(b)}}).catch(a=>this.verbose&&console.log(a))};setInterval(()=>{a||b()},this.websocket.request_timeout)}async random_data(m,d,n,h){$("#raven-multi-output-panel-body-table").html("");let i=Object.keys(this.qb_world_cities).length,j=this.qb_world_countries.length,o=h.length,k=["20","21","22","23","25","53","80","110","123","443","3389","5900"];for(let l=0;l<m;l++)if(this.global_lock)this.verbose&&console.log("interface is not visable");else{let b=null,c=null,e=h[Math.floor(Math.random()*o)],a=this.random_bg_color();if("Countries"===e)b=this.qb_world_countries[Math.floor(Math.random()*j)].properties.cc,c=this.qb_world_countries[Math.floor(Math.random()*j)].properties.cc,b&&c&&b!==c&&!b.includes("-99")&&!c.includes("-99")&&this.add_to_data_to_table({from:b,to:c},{line:{from:a,to:a},country:{from:a,to:a}},d,["line","multi-output","single-output"]);else if("Cities"===e){let f=Object.keys(this.qb_world_cities)[Math.floor(Math.random()*i)],g=Object.keys(this.qb_world_cities)[Math.floor(Math.random()*i)];f&&g&&f!==g&&this.add_to_data_to_table({from:f,to:g},{line:{from:a,to:a},country:{from:a,to:a}},d,["line","multi-output","single-output"])}else if("IPs"===e){let p=[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())],q=[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())],r=k[Math.floor(Math.random()*k.length)];b=p.join("."),c=q.join("."),b&&c&&b!==c&&this.add_to_data_to_table({from:b,to:c+":"+r},{line:{from:a,to:a},country:{from:a,to:a}},d,["line","multi-output","single-output"])}else"Coordinates"===e&&(b=[360*Math.random()-180,360*Math.random()-180],c=[360*Math.random()-180,360*Math.random()-180],b&&c&&b!==c&&this.add_to_data_to_table({from:b,to:c},{line:{from:a,to:a},country:{from:a,to:a}},d,["line","multi-output","single-output"]));await this.delay(n)}}}